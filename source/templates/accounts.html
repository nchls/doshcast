<div
	class="accounts"
	ng-cloak
	ng-controller="AccountsController"
>

	<div
		ng-show="!addStreamOpen"
	>

		<div class="actionBar">
			<button
				class="btn"
				ng-click="handleAddStreamClick()"
			>
				<i class="fa fa-plus"></i> Add Account
			</button>
		</div>

		<ul
			class="streams-list"
		>
			<li
				class="stream-group"
				ng-repeat="typeKey in _.uniq(_.pluck(streams, 'type'))"
			>
				<h2>{{ _.find(streamTypes, {'typeKey': typeKey}).typeName }}</h2>
				<ul>
					<li
						class="stream item"
						ng-repeat="stream in _.filter(streams, {type: typeKey})"
						ng-click="handleStreamClick(stream.id)"
					>
						<div class="streamName">{{ stream.name }}</div>
						<div class="streamType">{{ _.find(streamTypes, {'subKey': stream.subtype}).subName }}</div>
					</li>
				</ul>
			</li>
		</ul>
	</div>

	<div
		class="addStreamPanel"
		ng-show="addStreamOpen"
	>

		<div class="actionBar">
			<button
				class="btn secondary"
				ng-click="closeAddStream()"
			>
				<i class="fa fa-arrow-left"></i> Accounts
			</button>
		</div>

		<form
			class="addStreamForm"
			method="post"
			data-url="{% url 'api' version="1" method="addStream" %}"
			ng-submit="handleAddStreamSubmit()"
		>

			<div
				ng-class="{formRow: true, cf: true, inline: (field.input.type === 'checkbox')}"
				ng-repeat="field in streamFields"
				ng-if="!field.showFor || (field.showFor && _.contains(field.showFor, newStream.type.typeKey))"
			>

				<div class="field">

					<label
						ng-if="field.input.type !== 'checkbox'"
						for="newStream-{{ field.jsName }}"
					>
						{{ getStreamLabel(field.key, newStream.type.typeKey) }}
					</label>

					<input
						ng-if="field.input.type !== 'select'"
						type="{{ field.input.type }}"
						id="newStream-{{ field.jsName }}"
						ng-model="newStream[field.jsName]"
						ng-required="field.validation.required"
					>

					<label
						ng-if="field.input.type === 'checkbox'"
						for="newStream-{{ field.jsName }}"
					>
						{{ getStreamLabel(field.key, newStream.type.typeKey) }}
					</label>

					<select
						ng-if="field.input.type === 'select' && field.key !== 'stream_subtype'"
						id="newStream-{{ field.jsName }}"
						ng-model="newStream[field.jsName]"
						ng-options="{{ getSelectOptions(field.key) }}"
						ng-required="field.validation.required"
					>
						<option value="">--- Choose {{ field.label | lowercase }} ---</option>
					</select>

					<select
						ng-if="field.key === 'stream_subtype'"
						id="newStream-{{ field.jsName }}"
						ng-model="newStream[field.jsName]"
						ng-options="type.subName group by type.typeName for type in streamTypes"
						ng-required="field.validation.required"
						ng-change="setNewStream(newStream.type, newStream.name)"
					>
						<option value="">--- Choose {{ field.label | lowercase }} ---</option>
					</select>

				</div>

				<p
					ng-if="field.helpText"
					class="helpText aside"
				>
					{{ getStreamHelp(field.key, newStream.type.typeKey) }}
				</p>

			</div>

			<div class="actionBar">
				<button
					class="btn secondary"
					ng-click="closeAddStream()"
				>
					Cancel
				</button>

				<button
					class="btn"
				>
					<i class="fa fa-plus"></i> Add Account
				</button>
			</div>

		</form>
	</div>

</div>